---
cssclasses:
  - hide_properties
  - line
---

# **[[16.1 Расширенные Настройки Кодировщика Nvidia| ОТКРЫТЬ НА ВЕСЬ ЭКРАН]]** / **[[16. Настройки Профиля|НАЗАД]]**
## **Настройки кодировщика для записи**
Если вы используйте один из готовых профилей, тут всё максимально просто. 
Чтобы настроить запись под себя вам нужны всего четыре параметра. 
По умолчанию они и так выставлены на хорошие значения которые предоставляют отличное качество и при этом размер файла будет приемлемым. Менять их стоит в случае если вы хотите получить ещё более высокий уровень качества или же наоборот пожертвовать им в целях экономии места на диске.

> [!success] **Целевое качество** | от 0 (макс. качество) до 51 (макс. экономия)
> Это основной метод управления качеством записи. Отвечает за силу сжатия. 
> Для повышения качества ставьте ниже, для экономии места на диске - выше.

> [!success] **maxQP** | от 0 (макс. качество) до 51 (макс. экономия)
> Параметр можно найти снизу в списке пользовательских настроек. Отвечает за силу сжатия в простых сценах, минимально допустимый уровень качества. Для повышения качества ставьте ниже, для экономии места на диске - выше.
> > [!bug]- Проблема с AV1
> > По какой-то причине параметры **enableMaxQP=1 maxQP=28** не работают для кодировщика NVENC AV1 в актуальных версиях OBS/Драйверов. Вероятнее всего это баг. Я рекомендую использовать сочетание **целевого качества** и **максимального битрейта** для этого кодировщика в данный момент. 
> > В готовом профиле **NVIDIA AV1**, в отличии от **NVIDIA H.264** и **NVIDIA HEVC** этот параметр не добавлен по умолчанию.

> [!success] **aqStrength** | от 1 (мин. динамика) до 15 (макс. динамика)
> Параметр можно найти снизу в списке пользовательских настроек. Он улучает качество сжатия, особенно в динамичных сценах. Для записи динамичного контента используйте значения 8-15, для менее динамичного 4-8.
# **Настройки Кодировщика для Трансляции**

Чтобы настроить трансляцию в OBS, для начала установите настройки потоковой службы, перейдя в **`Настройки - Трансляция`**, а затем настройки кодировщика по пути  **`Настройки - Вывод - Трансляция`**. В этом случае доступен лишь один вывод на один потоковый сервис. Стриминг на несколько платформ с настройками в самом OBS возможен только через рестрим-сервисы или плагины.

> [!important] Я рекомендую использовать плагин **Aitum Multistream** для этих задач:
> ![[Aitum Multistream]]

Как я уже говорил ранее на странице [[8.1 Плагины|плагины]], для установки плагина нужно скопировать его файлы из скачанного архива (например, папки data, obs-plugins) в свою корневую папку OBS (туда, где находятся bin, config, data и obs-plugins). Обязательно перезапустите OBS.

Чтобы настроить мульти-стрим вывод после установки плагина перейдите в коллекцию **LIVE**, где уже добавлена док-панель **Aitum Multistream**. Либо, если вы используйте собственную коллекцию, добавьте её вручную через выпадающее меню Док-панели в верхнем меню OBS.

Для того чтобы перейти к настройке нажмите на иконку ⚙️ в док-панели **Aitum Multistream**. Перейдите в **основной холст** и нажмите в верхнем правом углу на кнопку **добавить вывод** и следуйте инструкциям на экране. После создания вывода нажмите на **дополнительные настройки** на нём.

> [!info] Кстати...
> Настройки трансляции в **Aitum Multistream** и в **настройки в самом OBS** можно использовать вместе для экономии ресурсов кодировщика видеокарты. После добавления вывода в **Aitum Multistream** в поле **кодировщик** можно выбрать **основной кодировщик**. Под ним имеются ввиду настройки OBS из **`Настройки - Вывод - Трансляция`**. Вы можете создать несколько выводов в **Aitum Multistream** на разные потоковые сервисы (если их требования совпадают) используя в каждом из них **основной кодировщик**, эти выводы не будут дополнительно нагружать кодировщик видеокарты. Увеличится лишь нагрузка на сеть. Таким образом можно стримить, например на **Twitch** (настроенный в **основных настройках OBS**) и **VK Видео** (выбрав для него **основной кодировщик** в **Aitum**), используя **основной кодировщик** с настройками в OBS из моих рекомендаций для Twitch (они наиболее строгие в плане ограничений битрейта), а на YouTube с отдельными настройками. В этом случае кодировщик будет нагружен лишь двумя видео-потоками.

> [!info] Но и это ещё не все...
> Если в вашей системе две видеокарты с кодировщиками, например Nvidia RTX 2060 Super и процессор Intel Core i9-9900K со встроенным видеоядром UHD Graphics 630. Вы можете использовать в разных выводах **Aitum Multistream** кодировщики разных видеокарт. Таким образом можно максимально поднять поднять параметры с влиянием на качество при CBR с повышенной нагрузкой (например, предустановка P7 для Nvidia или TU1 для Intel) для каждого вывода не боясь перегрузить кодировщик из-за них. Работоспособность максимальных настроек качества на всех видеокартах и при любом разрешении и частоте кадров, разумеется не гарантируется, однако подобный сценарий использования точно стоит рассмотреть если в системе несколько видеокарт с кодировщиками, чтобы разгрузить каждый из них.

Теперь вы готовы к настройке трансляции. Изучите рекомендации и пресеты ниже чтобы настроить трансляцию под свои задачи.

> [!example] # ⠀Трансляция на YouTube
> > [!example]- **H.264** | Ключ **1440p60** | Доступна **Низкая задержка** и выше
> > ![[YouTube H.264  Ключ1440p60 + Низкая задержка и выше.png]]
> ---
> > [!example]- **H.264** | Ключ **1080p60** | Доступна **Сверхнизкая задержка **и выше
> > ![[YouTube H.264  Ключ1080p60 + Сверхнизкая задержка и выше.png]]
>---
> > [!example]- **H.264** | Ключ **4K60** | Доступна только **Стандартная задержка**
> > ![[YouTube H.264 Ключ 4K60 + Стандартная задержка.png]]
> 
> > [!example]- **HEVC** | Ключ **1440p60** | Доступна **Низкая задержка** и выше
> > ![[YouTube HEVC Ключ 1440p60 + Низкая задержка и выше.png]]
> ---
> > [!example]- **HEVC** | Ключ **1080p60** | Доступна **Сверхнизкая задержка** и выше
> > ![[YouTube HEVC Ключ 1080p60 + Сверхнизкая задержка и выше.png]]
> ---
> > [!example]- **HEVC** | Ключ **4K60** | Доступна только **Стандартная задержка**
> > ![[YouTube HEVC Ключ 4K60 + Стандартная задержка.png]]
> 
> > [!example]- А что насчёт **AV1**?
> Для кодировщика **AV1** параметры будут аналогичны **H.264** и **HEVC**. Выберете кодировщик **NVENC AV1** и установите их, ориентируясь на фото выше.
> 
> > [!example]- **Настройки звука**
> ![[YouTube Звук Трансляции.png]]
---
> [!question]- У меня монитор с Х разрешением, какой ключ на YouTube выбрать?
> На этом сервисе используются ключи с разными разрешениями и по началу может показаться что использовать их нужно по прямому назначению, т.е. у вас монитор с разрешением 1080p... Значит нужно использовать ключ для 1080p, да? Нет.
> 
> **Ключи трансляции** стоит воспринимать скорее как **пресеты транскодирования**. То есть **даже отправляя на YouTube стрим в 1080p60 вы получите прирост в качестве** **если будете использовать ключ для 4K60** (конечно вы получите и штраф к задержке, ведь с ним можно использовать лишь **стандартную задержку**).
> 
> ![[Ключи1.png]]
> 
> Я не рекомендую использовать стандартный **Default Stream Key** на YouTube, так как в этом случае сервис выберет ключ как раз таки под ваше разрешение, и если у вас монитор 1080p и вы стримите в его нативном разрешении вам этого не надо. **Транскодирование 1080p на YouTube происходит в очень низком качестве**.
> 
> ![[Ключи2.png]]
> 
> Так что **воспринимайте ключи на YouTube** только как **инструмент настройки баланса между качеством и задержкой**, реальное **разрешение вашего стрима** тут вообще **не нужно брать в расчёт.** Примеры: 
> 
> 1. Я прохожу современную и красивую игру, почти не общаясь с чатом.
>    Лучший выбор - **4K60 ключ** со **стандартной задержкой**. (Да, даже если вы стримите в 1080p). Почему? Слегка жертвуя задержкой вы получайте максимальное качество транскодирования доступное на YouTube и возможность установить максимальный доступный битрейт на YouTube в 51000kbps.
> 2. Я играю в киберспортивную игру постоянно общаясь с чатом. 
>    Лучший выбор - **1440p60 ключ** с **низкой задержкой**. Почему? Это сбалансированный вариант который делает общение с чатом проще, но все ещё предлагает неплохое качество транскодирования и установку битрейта до 38000kbps, чего будет более чем достаточно для большинства игр.
> 3. Хоть я добавил настройки для **1080p60** ключа, **я не рекомендую использовать его для игровых стримов**. Качество будет просто ужасное. Можно использовать его на максимально нединамичных стримах, например когда на экране лишь ваша камера и вы постоянно общаетесь с частом и вы хотите использовать сверхнизкую задержку, которая доступна только для ключей 1080p. По факту этот вид задержки почти не выигрывает у низкой задержки, так что гнаться за ним не стоит. Даже в таком случае используйте ключ 1440p60 и низкую задержку.
>    
Кстати, **вы можете создать несколько ключей**, например 4K60 и 1440p60, а затем добавить их в OBS как два разных вывода с помощью плагина Aitum Multistream. Выставить для них разные значения битрейта (для 4K60 - 51000kbps, для 1440p60 - 38000kbps) и использовать их переключаясь между ними на YouTube в зависимости от тематики стрима, например жанра и детализации игры в которую собираетесь играть.

> [!example] # ⠀Трансляция на Twitch
> > [!example]- **Динамичный Контент**
> > ![[Twitch_ВысокаяДинамика.png]]
> > >[!warning] Не забудьте поставить галочку **не учитывать рекомендации сервиса** на вкладке **трансляция**, если используйте основные настройки OBS для трансляции. В плагине Aitum она уже автоматически установлена за вас.
> > > ![[Не учитывать рекомендации.jpg]]
> 
> > [!example]- **Нединамичный Контент**
> > ![[Twitch_НизкаяДинамика.png]]
> > >[!warning] Не забудьте поставить галочку **не учитывать рекомендации сервиса** на вкладке **трансляция**, если используйте основные настройки OBS для трансляции. В плагине Aitum она уже автоматически установлена за вас.
> > > ![[Не учитывать рекомендации.jpg]]
> 
> > [!example]- **Настройки Звука**
> > ![[Twitch_Звук.png]]
---
> [!question]- Другие авторы рекомендуют использовать низкие разрешения на Twitch (936p). Стоит ли так делать?
> Да. Так как на Twitch установлено ограничение по битрейту 8500kbps.
> 
> Чем выше разрешение трансляции, тем больше битрейта нужно чтобы добиться хорошего качества. При записи это, как правило, не проблема. Но вот в случае с Twitch у нас 8500kbps. По факту этого иногда мало даже для стрима в 1080p60, поэтому стримеры и понижают разрешение т.к. для того чтобы отобразить конкретную игру в нормальном качестве в этом разрешении 8-ми тысяч битрейта просто недостаточно. Поэтому динамичные и детализированные игры иногда вынуждают снижать разрешение трансляции для достижения приемлемого качества.
> 
> ![[Масштаб.png]]
> 
> Как сделать это правильно? По сути "волшебных" и подходящих для всех разрешений не существует, тут суть именно в балансе. Первым делом вы устанавливайте максимальный доступный битрейт и смотрите на качество картинки на стриме в 1080p или другом разрешении, например 2560х1080 для 21:9. От игровых стримов в 1440p лучше отказаться сразу. Если качество картинки в динамике в нужном вам разрешении вас устраивает - приступайте к делу. А если нет - понижайте разрешение с помощью **масштабирования при выводе** с **бикубическим фильтром** постепенно, пока не получите хороший уровень качества. Не обязательно использовать предложенные разрешения масштабирования. Например, 1664x936 в списке не будет, но оно может оказаться золотой серединой между 900p и 1080p.
---
> [!question]- Почему моя трансляция на Twitch отображается в 720p + 3500Kbps в РФ?
>  ![[16.7 Проблемы с Twitch]]

Чтобы начать трансляцию через **Aitum Multistream** нажмите на иконку📡рядом с выводом в панели **Aitum**. Если вы использовали **основной кодировщик** для экономии производительности (подробнее выше), вам потребуется сначала нажать на кнопку **начать трансляцию** в правом нижнем углу OBS, тем самым запустить трансляцию на сервис, настроенный в OBS-настройках. В случае если вы настраивали трансляцию только в настройках OBS (без **Aitum Multistream**), также используйте эту кнопку.
## **Другие параметры и рекомендации** (для опытных пользователей)
В готовых профилях эти параметры уже установлены на удачные значения. Но информация о них и другие рекомендации ниже пригодится вам если вы хотите ещё более детально настроить запись/трансляцию под себя, создаёте собственный профиль или вам нужна помощь в устранении проблемы.

> [!todo] **Управление битрейтом**
> Битрейт - количество памяти которое кодировщик займёт за секунду работы.
> Лучших вариантов два: **CQVBR** - для записи, **CBR** - для стрима.
---
> [!faq]- Почему именно **CQVBR** и **CBR**?
> **CQVBR** это продвинутый вариант переменного битрейта сразу с тремя основными настройками качества, такими как **Целевое качество**, **Минимальное качество** (или **maxQP**) и **Максимальный битрейт**. 
> 
> Главный плюс переменного битрейта в удобной настройке качества и эффективном использовании памяти на диске. 
> 
> При постоянном битрейте **CBR** качество регулируется фиксацией битрейта и использует память неэффективно, ведь если на экране простая сцена или даже статичное изображение, кодировщик займёт при записи столько же места, сколько и при записи крайне динамичной сцены. В одной сцене этого значения будет слишком много и вы в пустую потратите место на диске, а в другой даже хуже, заданного битрейта окажется мало и картинка рассыпится на артефакты. 
> 
> В то же время переменный битрейт **CQVBR** будет удерживать качество на заданном уровне и использовать столько битрейта (памяти в секунду), сколько требуется в конкретный момент для поддержания одного уровня качества на протяжении всей записи. А значит в сцене со статичным изображением (рабочий стол, игровое меню или экран инвентаря) ему потребуется совсем минимальный битрейт и в таких случаях вы экономите место в сравнении с **CBR**. Плюс ко всему вы можете настроить минимальный уровень качества (MaxQP) чтобы более гибко настроить кодировщик для максимальной экономичности. В динамичной сцене всё точно также, **CQVBR** использует столько памяти, сколько нужно для поддержания качества, когда CBR использует статичное значение потребления памяти, которого опять же хватит в одной сцене, но может не хватить в другой. Также для экономии памяти в сложных сценах **CQVBR** имеет параметр с ограничением максимального битрейта.
> 
> Но **CBR** всё также необходим для проведения прямых трансляций, которые могут работать только с этим типом управления битрейта.

> [!todo] **Битрейт при CBR** (для стрима)
> Значение битрейта регулируется в рамках требований потокового сервиса и возможностей вашего подключения к интернету.
> Реальные ограничения популярных потоковых сервисов:
> - **YouTube**, ключи 4K - **51000 Kbps**
> - **YouTube**, ключи 1440p - **38000 Kbps**
> - **YouTube**, ключи 1080p - **12750 Kbps**
> - **Twitch** - **8500 Kbps** (для видео и аудио, пример: 8400 Kbps видео + 96 Kbps аудио)
> - **VK Видео** - **30000 Kbps**
> 
> Эти значения я и указывал в рекомендованных настройках для сервисов выше, но они могут не работать у вас из-за недостаточно быстрого или нестабильного подключения к интернету. В таком случае снижайте битрейт пока не уложитесь в возможности сети. Узнать скорость вашего подключения можно с помощью [speedtest](https://www.speedtest.net/). Подробнее об устранении проблем с сетью и битрейтом читайте ниже.
---
> [!question]- Почему эти ограничения по битрейту выше рекомендованных сервисом?
> Значения выше могут отличаться от официальных рекомендаций, указанных на самих сервисах. Я указал **реальные значения**, проверенные опытным путём. И при том, что в случае с **Twitch** и **YouTube** эти значения выше заявленных, их использование не приведёт к проблемам и блокировкам, а вот их превышение уже может повлечь за собой ошибки. Официальные требования немного занижены чтобы снизить нагрузку на сервера и избежать проблем при ошибках кодирования у автора в виде скачков битрейта выше установленного, а в случае с Twitch сделать просмотр стрима у автора без транскодирования комфортнее для зрителей с медленным интернетом.
---
> [!question]- Могут ли возникнуть проблемы у зрителей из-за высокого битрейта?
> **На YouTube и VK Видео - нет**. Сервисы предлагают транскодирование потока для всех авторов. Это означает что зритель с медленным интернетом может выбрать более низкое качество трансляции с битрейтом ниже, чем у вашего стрима-источника.
> 
> **В случае с Twitch проблемы возможны**, т.к. сервис не предоставляет транскодирование всем авторам в целях экономии ресурсов их серверов.
---
> [!question]- О транскодировании на **Twitch** и **Enhanced Broadcasting**.
> Авторы делятся на три группы: **новички**, **компаньоны** и **партнёры**. **Партнёры** получают транскодирование с максимальным приоритетом, почти всегда если сервера не перегружены. **Компаньоны** вторые на очереди за транскодированием и получают его только когда нагрузка на сервера **Twitch** это позволяет. Отсутствие транскодирования означает что зрители могут смотреть ваш стрим лишь в оригинале и при медленном интернете возможности снизить качество у них не будет. 
> После начала развёртывания обновления **Enhanced Broadcasting** для **Twitch**, в OBS появилась возможность настроить транскодирование на стороне клиента, мощностями вашего ПК, что пригодится авторам без **партнёрки Twitch**. Чтобы настроить данный способ транскодирования, следуйте данной инструкции:
> 
> ![[16.9 Транскодирование на стороне клиента для Twitch]]
---
> [!question]- Устранение популярных сетевых проблем
>Рекомндации: 
> - Чтобы повысить стабильность подключения я, в первую очередь, рекомендую использовать проводное соединение, когда это возможно. Простое подключение вашего устройства ethernet кабелем к маршрутизатору вместо Wi-fi или мобильного интернета может исправить множество проблем и сильно улучшить возможности вашей трансляции.
> - Постарайтесь минимизировать использование сети во время стрима, закройте лишние вкладки браузера и избегайте просмотра в нем собственного стрима.
> - Закройте программы, которые используют сеть в фоне, например torrent-клиенты. 
> - Убедитесь что другие устройства не используют много трафика в рамках вашей сети, например попросите вашу девушку/парня приостановить скачивание игры на время вашей трансляции.
> - Проверьте предложения интернет-провайдеров. Возможно один из них предоставляет тариф с высокой скоростью подключения по цене не сильно больше или даже меньше вашего текущего варианта.
> - Убедитесь что маршрутизатор (роутер), кабель подключения, адаптер вашего устройства или его настройки не являются узким местом вашего подключения. Если тариф предоставляет высокую скорость, но по факту вы её не получайте стоит обратить на это внимание.
> 
>Примеры популярных проблем:
>   1. Если при использовании интернета несколькими устройствами в сети, скорость сильно снижается (особенно по Wi-fi), это может означать что роутер не справляется со своей задачей. 
>   2. Вы используйте тариф 1000 Мбит и качественный роутер, но подключили ПК к нему Ethernet кабелем стандарта Cat 5, который поддерживает лишь до 100 Мбит, когда в этом случает требуется кабель стандарта Cat 5e и выше.
>   3. В вашем устройстве установлен устаревший Etherntet или Wi-fi адаптер. В случае с первым можно купить ему USB или PCI замену. А в случае со вторым минимизировать расстояние до источника Wi-fi или переключиться на проводное подключение.
>   4. Вы посмотрели ролик с оптимизацией Windows и "оптимизировали" настройки своего Ethernet адаптера, после чего появились проблемы с трансляцией или упала скорость подключения. В этом случае стоит откатить все изменения, если возможно, или полностью удалить драйвер адаптера из системы и установить его с нуля. Если вы использовали программу по типу TCP-Otimizer, откатите все изменения в ней.
---
> [!question]- Я установил значение в рамках требований потоковой службы и мой интернет имеет достаточно высокую скорость для стрима. Почему стрим тормозит и OBS указывает на потерю кадров (сеть)?
> Всё указывает на **проблемы с соединением с конкретным потоковым сервисом**. 
> Многие пользователи из РФ столкнулись с подобными проблемами в случае с **YouTube** после его замедления. В первую очередь стоит попробовать **постепенно снижать битрейт** пока проблема не уйдёт (да, даже в случае если вы используйте параметры которые я рекомендовал выше и скорости интернета для них достаточно). Вы можете попробовать **сменить сервер**, установив вместо **Primary YouTube ingest server** один из других вариантов, например **Legacy RTMP** (в этом случае стрим с кодировщиком HEVC может не работать). Если это не поможет, проблему стоит искать в первую очередь в **способе доступа к YouTube в РФ**, который вы используйте.

> [!todo] **Максимальный Битрейт** при CQVBR (для записи)
> **Не путать с установкой битрейта при CBR (для стрима)**, не смотря на схожие названия **он работает совершенно по другому**. В отличии от CBR, при CQVBR качеством в первую очередь управляет не ограничение по битрейту, а значение **целевого качества**.
> При **CQVBR** битрейт постоянно меняется в зависимости от сложности сцены чтобы удерживать уровень качества заданный параметрами (**Целевое качество** и **maxQP**).
> C помощью ограничения максимального битрейта можно ограничить его верхний порог чтобы даже если для поддержания заданного качества потребуется больше битрейта, он не "прыгнул" выше данного значения. Параметр нужен только для экономии размера файла. Установить можно на значение **от 1 до 4294967З**, а **0** включает автоматическую установку битрейта с учетом разрешения экрана согласно **таблице уровней**.
> 
> **В моей настройке максимальный битрейт по умолчанию не работает, так как в строку параметров заранее добавлены enableMaxQP= maxQP= (подробнее ниже).**
---
> [!question]- Таблица Уровней
> ![[Levels Таблица.png]]
---
> [!warning]- Не торопитесь использовать **максимальный битрейт**!
> В актуальных версиях OBS / драйверов Nvidia, существует баг или особенность из-за которой этот параметр не работает в паре с **enableMaxQP= maxQP=**.
> А значит придётся делать выбор между установкой максимального битрейта или параметром максимально качества (**maxQP**). Проблема была найдена пользователями моего [телеграм сообщества](https://t.me/a11p1ay) совсем недавно и пока мало изучена, так что я не буду давать однозначных рекомендаций. Советую отдать предпочтение **maxQP** и настраивать баланс качества и экономичности только с помощью **целевого качества** и **минимального качества** (**maxQP**), а максимальный битрейт подойдёт для ситуаций когда на первом месте стоит экономия места на диске.
---
> [!question]- Как понять на каком значении лучше установить максимальный битрейт если вы всё же решили им воспользоваться?
> Я рекомендую следить за показателями текущего и среднего битрейта при просмотре ролика с помощью статистики в плеере [**MPC-HC**](https://github.com/clsid2/mpc-hc/releases/). Для этого нажмите **Вид** в верхнем меню, включите **Статистику** и она появится снизу. 

> [!todo] **Интервал ключевых кадров**
> Отвечает за то как часто они будут кодироваться. Уменьшение интервала увеличит качество и размер файла. Оптимальное значение - **1-4с**. Может быть среди требований или рекомендаций потоковых сервисов. Безопасное значение для записи всех типов контента, поддерживаемое на всех потоковых сервисах - **2 ключевых кадра**.
---
> [!question] К слову...
> Количество ключевых кадров влияет на удобство перемотки в проигрывателях, а также на удобство редактирования в LosslessCut - чем больше таких кадров - тем больше точек, где можно выполнить обрезку.

> [!todo] **Предустановка**
> Улучшает качество сжатия ценой большей нагрузки на кодировщик видеокарты.
> **При переменном битрейте CQVBR**: крайне незначительно повышает качество картинки и снижает размер файла. Использование значений c P5 по P7, абсолютно бессмысленно. Нагрузка на кодировщик кратно повышается ради повышения качества и экономии менее чем на 1% (я не шучу). Оптимальное значение - **P1** (Для уверенности можно поставить **P4**).
> **При постоянном битрейте CBR**: каждый шаг предустановки с P1 по P7 улучшает качество картинки. Оптимальные значения - **P4** (лучший баланс качества и нагрузки на кодировщик), или **P6** (лучшее качество ценой большей нагрузки). P7 чаще всего даёт совсем незначительный прирост в качестве по объективным тестам ценой заметно большей нагрузки на кодировщик.
---
> [!faq] Кстати...
> Нагрузка на кодировщик не означает снижение игрового FPS при записи/стриме. Кодировщик - отдельный узел видеокарты со своим процентом загрузки. Видеокарта не делит свою производительность между игрой и записью и изменение параметров кодировщика почти никогда не будет влиять на игровую производительность. Следить за нагрузкой на кодировщик нужно лишь для того чтобы он не перегрузился. У каждого кодировщика в зависимости от видеокарты свой запас производительности. И именно в возможности кодировщика вам нужно уложится при его настройке. Следить за процентом загрузки кодировщика можно в **[[Диспетчер Задач.lnk|диспетчере задач]]** во вкладке **производительность**, нажав на нужную видеокарту. Вас интересует график **Encode**.
---
> [!question]- Если так, то почему во время записи в OBS я вижу огромный процент загрузки видеокарты именно по 3D в диспетчере задач?
> Переживать не стоит, скорее всего вы проверяете это просто на рабочем столе, без какой либо другой нагрузки на GPU. В этом случае диспетчер задач отображает процент загрузки 3D неверно когда OBS использует CUDA ядра видеокарты. Если сначала открыть игру, а уже затем включить запись в OBS, то вы увидите, что процент загрузки GPU по 3D никак не изменился, т.к. на самом деле обычно запись потребляет даже менее 1% по 3D.
---
> [!question]- Стоп, OBS использует CUDA-ядра? Как и игры? Так кодирование снижает FPS?
> Нет, не снижает. Ряд параметров кодирования действительно задействуют CUDA-ядра видеокарты, но на такой ничтожный процент, что это можно даже не брать во внимание, и это факт, который подтверждается как информацией от Nvidia, так и моими тестами на канале. Ещё раз, **не нужно их отключать чтобы повысить игровой FPS**, это **не сработает**. Тем не менее, вот их список:
> 
> ![[CUDA.png]]

> [!todo] **Регулировка**
> Набор параметров для настройки кодировщика. Оптимальное значение - **Высокое качество**. (Если при записи с высоким разрешением (4K60FPS) или частотой кадров (120/240FPS) кодировщик перегружается и снижение **предустановки** до P1 не помогает, можно поставить **низкую** или **сверхнизкую задержку** чтобы улучшить производительность ценой снижения качества сжатия)

> [!todo] **Многопроходный режим**
> Улучшает качество сжатия ценой большей нагрузки на кодировщик видеокарты.
> **При переменном битрейте CQVBR (запись)**: **двойной проход (четверть разрешения)** незначительно снижает размер конечного файла по сравнению с **одиночным проходом**. Вариант с **полным разрешением** не улучшает результат по сравнению с **четвертью** но заметно увеличивает нагрузку. Рекомендуемое значение - **двойной проход (четверть разрешения)**.
> **При постоянном битрейте CBR (стрим)**: всё точно также, только параметр влияет на качество, а не на размер файла. Используйте - **двойной проход (четверть разрешения)**.
> 

> [!todo] **Профиль**
> Набор настроек кодировщика для разных задач. Оптимальное значение для **H.264** - **high**, для **HEVC** - **main**. А **main10** используется для [[16.8 Запись в HDR|записи в HDR]].

> [!todo] **Предугадывание**
> Улучшает качество сжатия с помощью анализа будущих кадров.
> **При CQVBR (для записи)** оптимально будет включить этот параметр для работы адаптивных ключевых кадров. И **отключить B-кадры**.
> **При CBR (для стрима)** лучше **отключить** параметр для динамичного контента с **1-2 B-кадрами** или **включить** для наименее динамичного контента с **3-4 B-кадрами**.

> [!todo] **B-кадры**
> Количество сжатых кадров, которые позволяют экономить битрейт.
> **При CQVBR (для записи)** оптимальным будет значение 0 B-кадров, при данном типе кодирования они заметно ухудшают качество картинки и при этом не позволяют экономить место на диске.
> **При CBR (для стрима)** рекомендую устанавливать значение в зависимости от уровня динамики изображения на стриме. При высокой динамике (шутеры и "графонистые" сюжетные игры) оптимальными будут **1-2 B-кадра**, а при низкой динамике (например стратегии, dota, карточные игры) можно попробовать **3-4 B-кадра** с **активным предугадыванием**. Универсальным значением при **CBR** для всего можно считать **2 B-кадра**.

> [!todo] **Пользовательские настройки кодировщика**
> 
> **enableMaxQP=1** - Включает регулировку **минимального качества** (1 - вкл, 0 - выкл).
> 
> **maxQP=26** - Задаёт значение (от 0 до 51) минимального качества (подробнее выше).
> 
> **enableLookahead=1** - Включает предугадывание (подробнее выше), дублирует аналогичный параметр доступный в OBS для дальнейшей настройки. (1 - вкл, 0 - выкл).
> 
> **lookaheadDepth=32** - Задаёт **глубину предугадывания** (1 мин - 32 макс)
> **При CQVBR (для записи)** рекомендуется **значение глубины 32**.
> **При CBR (для стрима)** если вы **включили предугадывание** (менее динамичный контент), также рекомендуется **значение глубины 32**.
> 
> **enableAQ=1** - Включает **пространственное квантование**.
> **enableTemporalAQ=1** - Включает **временное квантование**.
> Данные параметры являются аналогом параметра **адаптивная квантизация** (подробнее выше) в OBS и включают оба ещё типа для дальнейшей настройки.
> 
> **aqStrength=12** - Задаёт **силу адаптивной квантизации** от 1 до 15 (подробнее выше).

# **[[16.1 Расширенные Настройки Кодировщика Nvidia| ОТКРЫТЬ НА ВЕСЬ ЭКРАН]]** / **[[16. Настройки Профиля|НАЗАД]]**